# 留档-保存修改记录指引

> 本文档用于指导在 Agent 对代码进行变更后，如何及时捕捉"工程闪光点"并进行素材留档。
>
> **核心原则**：留档内容应**基于本次变更的实际特性**，由 Agent 动态分析得出，而非填充固定模板。

---

## 一、核心理念

### 动态分析原则

| 原则 | 说明 |
|------|------|
| **变更导向** | 基于本次实际变更内容进行分析 |
| **特性发掘** | 识别本次变更的独特价值和亮点 |
| **因地制宜** | 根据变更类型和规模调整留档深度 |
| **价值优先** | 记录真正有价值的内容，而非机械填表 |

---

## 二、变更留档 Prompt 模板

### 2.1 完整版（适用于较大变更）

```
Role: 你刚刚完成了一次代码变更。

Task: 请基于**本次实际变更内容**，进行素材留档。

**第一步：理解变更**
- 本次变更解决了什么问题？
- 变更的核心内容是什么？
- 涉及哪些模块/文件？

**第二步：工程演进记录**
如适用，请按以下逻辑记录：
- **原状/瓶颈**：变更前存在什么问题？
- **解决策略**：采用了什么技术手段？为什么？
- **改进效果**：达到了什么效果？如何验证？

**第三步：素材分类**

**亮点箱**：本次变更中值得展示的技术实现
- 有哪些技术亮点或优化？
- 有哪些体现深度思考的设计决策？
- 相比朴素实现，这些改进带来了什么提升？

**稳健箱**：本次变更中增强可靠性的部分
- 新增了哪些错误处理或边界检查？
- 有哪些增强系统稳定性的改进？

**债务箱**：诚实记录待改进之处
- 留下了哪些 TODO 或已知问题？
- 有哪些后续可以优化的方向？

**第四步：量化记录**（如适用）
- 本次变更是否带来可量化的改进？
- 有没有"金标准"可以作为对比基准？
- 改进前后的数据对比是什么？

**第五步：变更叙事**
回答以下黄金问题：
- **Why this?** 为什么采用这种方案？
- **So what?** 带来了什么具体效果？
- **What's next?** 还有什么可以改进的？
```

### 2.2 简化版（适用于快速留档）

```
请对本次代码变更进行快速留档：

1. **变更概述**：做了什么？解决了什么问题？

2. **亮点**：有什么值得展示的技术实现？

3. **稳健**：新增了哪些可靠性改进？

4. **债务**：留下了哪些待改进的地方？

5. **一句话叙事**：从[原状]到[改进后]，通过[方法]，实现了[效果]
```

---

## 三、留档时机与深度

| 变更类型 | 建议留档深度 | 重点关注 |
|----------|--------------|----------|
| 重大特性开发 | 完整版 | 架构设计、技术选型的 Why this |
| 问题修复 | 完整版 | 瓶颈分析、解决策略的演进过程 |
| 性能优化 | 完整版 + 量化数据 | 前后对比、与金标准的差距 |
| 重构改进 | 完整版 | 架构变化、Trade-off 考量 |
| 日常小改动 | 可跳过 | 在 Git Commit 中记录即可 |

---

## 四、Agent 自主发掘指引

> **关键**：Agent 应根据变更内容自主判断，而非机械套用模板

### 4.1 亮点发掘思路

```
请分析本次变更，思考：
1. 这次变更中最有技术含量的部分是什么？
2. 相比简单/朴素的实现，这次实现有什么优势？
3. 有哪些设计决策体现了深度思考？
4. 这些亮点如何用代码片段或图表展示？
5. 如果要向他人解释 "Why this?"，怎么说？
```

### 4.2 工程演进发掘思路

```
请分析本次变更的演进过程：
1. 变更前的状态是什么？存在什么问题？
2. 如何发现这个问题/瓶颈的？
3. 尝试了哪些解决方案？
4. 最终选择了什么方案？为什么？
5. 效果如何验证？有没有量化数据？
```

### 4.3 量化验证发掘思路

```
请分析本次变更的可量化效果：
1. 有没有合适的"金标准"可以对比？
2. 变更前后的关键指标是什么？
3. 改进效果是否可以用图表展示？
4. 是否存在可以探索的参数敏感度？
```

### 4.4 债务识别思路

```
请诚实分析本次变更：
1. 由于时间或其他原因，有哪些地方没有做到最好？
2. 有哪些已知的限制或问题？
3. 后续有什么可以改进的方向？
4. 如果要回答 "What's next?"，怎么说？
```

---

## 五、与呈现-素材组织思路的关系

| 本文档（留档） | 素材组织思路（呈现） |
|----------------|----------------------|
| 单次变更的即时记录 | 整体项目的素材挖掘 |
| 过程中的素材积累 | 最终汇报的素材组织 |
| 亮点/稳健/债务三箱 | 亮点/稳健/债务三箱 |
| 变更叙事（单次） | 项目叙事弧线（整体） |
| 工程演进记录 | 工程演进叙事模式 |
| 量化验证 | 基准对齐/敏感度分析 |

**流程**：每次变更留档 → 项目结束后汇总 → 按素材组织思路整理 → 输出PPT/报告

---

> **提示**：留档的价值在于**捕捉当下的思考和发现**，时间久了这些细节容易遗忘。坚持留档习惯，项目结束时你将拥有丰富的素材库，讲述完整的工程演进故事！